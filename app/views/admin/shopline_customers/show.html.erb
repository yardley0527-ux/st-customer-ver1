<div class="container-fluid">

  <!-- Header 卡片 -->
  <div class="row">
    <div class="col-12">
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">客戶詳細資訊</h5>
          <div class="card-tools">
            <%= link_to '返回列表',
                  admin_shopline_customers_path(membership_level: @shopline_customer.membership_level),
                  class: 'btn btn-sm btn-secondary' %>
            <%= link_to '編輯個人資訊', edit_admin_shopline_customer_path(@shopline_customer), class: 'btn btn-sm btn-primary' %>
          </div>
        </div>

        <!-- 客戶總覽 -->
        <div class="card-body">
          <h4 class="mb-1"><%= @shopline_customer.full_name %></h4>

          <p class="mb-1">
            會員級別：
            <span class="badge bg-primary">
              <%= @shopline_customer.membership_level.presence || '一般會員' %>
            </span>
          </p>

          <p class="mb-1">
            IG：
            <% if @shopline_customer.instagram_account.present? %>
              <%= link_to @shopline_customer.instagram_account,
                          "https://instagram.com/#{@shopline_customer.instagram_account}",
                          target: "_blank",
                          rel: "noopener",
                          class: "text-decoration-underline" %>
            <% else %>
              <span class="text-muted">未填寫</span>
            <% end %>
          </p>

          <p class="mb-0">
            累積金額：
            <%= number_to_currency(@shopline_customer.total_amount, unit: 'NT$') if @shopline_customer.total_amount.present? %>
            ｜ 訂單數：<%= @shopline_customer.order_count %>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- 主要資訊卡片 (分欄) -->
  <div class="row">

    <!-- 基本資訊 -->
    <div class="col-12 col-lg-6 mb-3">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="mb-0">基本資訊</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm mb-0">

              <tr><th style="width: 30%">客戶 ID</th><td><%= @shopline_customer.shopline_id %></td></tr>
              <tr><th>姓名</th><td><%= @shopline_customer.full_name %></td></tr>
              <tr><th>電郵</th><td><%= @shopline_customer.email %></td></tr>
              <tr><th>加入日期</th><td><%= @shopline_customer.joined_at&.strftime('%Y-%m-%d %H:%M:%S') %></td></tr>
              <tr><th>加入來源</th><td><%= @shopline_customer.join_source %></td></tr>
              <tr><th>性別</th><td><%= @shopline_customer.gender %></td></tr>
              <tr><th>生日</th><td><%= @shopline_customer.birthdate&.strftime('%Y-%m-%d') %></td></tr>
              <tr><th>IG 帳號</th><td><%= @shopline_customer.instagram_account %></td></tr>

            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- 消費數據 -->
    <div class="col-12 col-lg-6 mb-3">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="mb-0">消費數據</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm mb-0">

              <tr><th style="width: 30%">訂單數</th><td><%= @shopline_customer.order_count %></td></tr>
              <tr><th>累積金額</th><td><%= number_to_currency(@shopline_customer.total_amount, unit: 'NT$') %></td></tr>
              <tr><th>已發放購物金</th><td><%= number_to_currency(@shopline_customer.issued_shopping_credits, unit: 'NT$') %></td></tr>
              <tr><th>已使用購物金</th><td><%= number_to_currency(@shopline_customer.used_shopping_credits, unit: 'NT$') %></td></tr>
              <tr><th>現有購物金</th><td><%= number_to_currency(@shopline_customer.current_shopping_credits, unit: 'NT$') %></td></tr>

            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- 會員資訊 -->
    <div class="col-12 col-lg-6 mb-3">
      <div class="card h-100">
        <div class="card-header"><h6 class="mb-0">會員資訊</h6></div>
        <div class="card-body">

          <div class="table-responsive">
            <table class="table table-sm mb-0">

              <tr><th style="width: 30%">會員註冊日期</th><td><%= @shopline_customer.member_registered_at&.strftime('%Y-%m-%d %H:%M:%S') %></td></tr>
              <tr><th>會員註冊來源</th><td><%= @shopline_customer.member_registration_source %></td></tr>
              <tr><th>會員級別</th><td><%= @shopline_customer.membership_level %></td></tr>
              <tr><th>會員有效期</th><td><%= @shopline_customer.membership_expiry_date&.strftime('%Y-%m-%d') %></td></tr>
              <tr><th>LINE ID</th><td><%= @shopline_customer.line_id %></td></tr>
              <tr>
                <th>黑名單</th>
                <td>
                  <span class="badge <%= @shopline_customer.blacklisted ? 'bg-danger' : 'bg-success' %>">
                    <%= @shopline_customer.blacklisted ? '是' : '否' %>
                  </span>
                </td>
              </tr>
              <tr><th>最後登入時間</th><td><%= @shopline_customer.last_login_at&.strftime('%Y-%m-%d %H:%M:%S') %></td></tr>

            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- 聯絡資訊 -->
    <div class="col-12 col-lg-6 mb-3">
      <div class="card h-100">
        <div class="card-header"><h6 class="mb-0">聯絡資訊</h6></div>
        <div class="card-body">

          <div class="table-responsive">
            <table class="table table-sm mb-0">

              <tr><th style="width: 30%">手機號碼</th><td><%= @shopline_customer.mobile_phone %></td></tr>
              <tr><th>國際電話區碼</th><td><%= @shopline_customer.country_code %></td></tr>
              <tr><th>聯絡電話</th><td><%= @shopline_customer.phone %></td></tr>
              <tr><th>地址 1</th><td><%= @shopline_customer.address_1 %></td></tr>
              <tr><th>地址 2</th><td><%= @shopline_customer.address_2 %></td></tr>
              <tr><th>城市</th><td><%= @shopline_customer.city %></td></tr>
              <tr><th>地區/州/省份</th><td><%= @shopline_customer.state %></td></tr>
              <tr><th>郵政編號</th><td><%= @shopline_customer.postal_code %></td></tr>
              <tr><th>國家</th><td><%= @shopline_customer.country %></td></tr>

            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- 備註與標籤 -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="card">
        <div class="card-header"><h6 class="mb-0">備註與標籤</h6></div>

        <div class="card-body">

          <% if @shopline_customer.tags.present? %>
            <p><strong>標籤：</strong> <%= @shopline_customer.tags %></p>
          <% else %>
            <p class="text-muted">未設定標籤</p>
          <% end %>

          <% if @shopline_customer.notes.present? %>
            <p><strong>備註：</strong> <%= simple_format(@shopline_customer.notes) %></p>
          <% else %>
            <p class="text-muted">沒有備註</p>
          <% end %>

          <!-- 個人備註（未來新增欄位後會自動顯示） -->
          <% if @shopline_customer.respond_to?(:personal_note) && @shopline_customer.personal_note.present? %>
            <p><strong>個人備註：</strong> <%= simple_format(@shopline_customer.personal_note) %></p>
          <% end %>

        </div>
      </div>
    </div>
  </div>

  <!-- 健康諮詢表（未來加 model 後可顯示） -->
  <% if @shopline_customer.health_questionnaire.present? %>
    <div class="row mt-3">
      <div class="col-12">
        <div class="card">
          <div class="card-header"><h6 class="mb-0">健康問卷 (Health Questionnaire)</h6></div>
          <div class="card-body">
            <% hq = @shopline_customer.health_questionnaire %>

            <table class="table table-sm mb-0">
              <tr><th style="width:30%">身高 (cm)</th><td><%= hq.height_cm %></td></tr>
              <tr><th>體重 (kg)</th><td><%= hq.weight_kg %></td></tr>
              <tr><th>體脂率 (%)</th><td><%= hq.body_fat_percentage %></td></tr>
              <tr><th>工作類型</th><td><%= hq.work_type %></td></tr>
              <tr><th>婚姻狀態</th><td><%= hq.marital_status %></td></tr>
              <tr><th>睡眠時間</th><td><%= hq.sleep_time %></td></tr>
              <tr><th>起床時間</th><td><%= hq.wake_time %></td></tr>
              <tr><th>飲水量 (ml)</th><td><%= hq.water_intake_ml %></td></tr>
              <tr><th>飲食類型</th><td><%= hq.diet_type.to_a.join(', ') %></td></tr>
              <tr><th>曾使用減重方法</th><td><%= hq.previous_weight_loss_methods %></td></tr>
            </table>

          </div>
        </div>
      </div>
    </div>
  <% end %>

</div>
