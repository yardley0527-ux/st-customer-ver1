<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">訂單詳情</h1>
    <div>
      <%= link_to "返回列表", admin_shopline_orders_path, class: "bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 px-4 rounded" %>
      <%= link_to "編輯訂單", edit_admin_shopline_order_path(@shopline_order), class: "ml-2 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded" %>
    </div>
  </div>

  <div class="bg-white shadow-md rounded p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <h2 class="text-lg font-semibold mb-4 pb-2 border-b">訂單資訊</h2>
        <table class="w-full">
          <tr>
            <td class="py-2 text-gray-600 w-1/3">訂單號碼</td>
            <td class="py-2 font-medium"><%= @shopline_order.order_number %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">訂單日期</td>
            <td class="py-2"><%= @shopline_order.order_date&.strftime('%Y-%m-%d %H:%M') %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">訂單狀態</td>
            <td class="py-2">
              <span class="<%= 
                case @shopline_order.order_status
                when '已完成' then 'bg-green-100 text-green-800'
                when '處理中' then 'bg-blue-100 text-blue-800'
                when '待出貨' then 'bg-yellow-100 text-yellow-800'
                when '已取消' then 'bg-red-100 text-red-800'
                else 'bg-gray-100 text-gray-800'
                end 
              %> px-2 py-1 text-xs rounded-full">
                <%= @shopline_order.order_status %>
              </span>
            </td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">付款狀態</td>
            <td class="py-2">
              <span class="<%= 
                case @shopline_order.payment_status
                when '已付款' then 'bg-green-100 text-green-800'
                when '未付款' then 'bg-red-100 text-red-800'
                when '已退款' then 'bg-yellow-100 text-yellow-800'
                else 'bg-gray-100 text-gray-800'
                end 
              %> px-2 py-1 text-xs rounded-full">
                <%= @shopline_order.payment_status %>
              </span>
            </td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">付款方式</td>
            <td class="py-2"><%= @shopline_order.payment_method %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">總金額</td>
            <td class="py-2 font-bold">$<%= number_with_delimiter(@shopline_order.total_amount.to_f, delimiter: ",") %></td>
          </tr>
        </table>
      </div>
      
      <div>
        <h2 class="text-lg font-semibold mb-4 pb-2 border-b">客戶資訊</h2>
        <table class="w-full">
          <tr>
            <td class="py-2 text-gray-600 w-1/3">客戶姓名</td>
            <td class="py-2 font-medium"><%= @shopline_order.customer_name %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">電子郵件</td>
            <td class="py-2"><%= @shopline_order.email %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">Instagram 帳號</td>
            <td class="py-2"><%= @shopline_order.instagram_account || "-" %></td>
          </tr>
          <tr>
            <td class="py-2 text-gray-600">會員等級</td>
            <td class="py-2"><%= @shopline_order.membership_level || "-" %></td>
          </tr>
          <% if @shopline_order.shopline_customer %>
            <tr>
              <td class="py-2 text-gray-600">客戶記錄</td>
              <td class="py-2">
                <%= link_to "查看客戶詳情", admin_shopline_customer_path(@shopline_order.shopline_customer), class: "text-blue-500 hover:text-blue-700" %>
              </td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>
  </div>
  
  <div class="bg-white shadow-md rounded p-6 mb-6">
    <h2 class="text-lg font-semibold mb-4 pb-2 border-b">商品詳情</h2>
    <table class="w-full">
      <tr>
        <td class="py-2 text-gray-600 w-1/4">商品名稱</td>
        <td class="py-2 font-medium"><%= @shopline_order.product_name %></td>
      </tr>
      <tr>
        <td class="py-2 text-gray-600">數量</td>
        <td class="py-2"><%= @shopline_order.quantity %></td>
      </tr>
    </table>
  </div>

  <% if @shopline_order.utm_source.present? || @shopline_order.utm_medium.present? || @shopline_order.utm_campaign.present? %>
    <div class="bg-white shadow-md rounded p-6">
      <h2 class="text-lg font-semibold mb-4 pb-2 border-b">行銷資訊</h2>
      <table class="w-full">
        <tr>
          <td class="py-2 text-gray-600 w-1/4">UTM 來源</td>
          <td class="py-2"><%= @shopline_order.utm_source || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 媒介</td>
          <td class="py-2"><%= @shopline_order.utm_medium || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 來源/媒介</td>
          <td class="py-2"><%= @shopline_order.utm_source_medium || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 活動名稱</td>
          <td class="py-2"><%= @shopline_order.utm_campaign || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 活動字詞</td>
          <td class="py-2"><%= @shopline_order.utm_term || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 活動內容</td>
          <td class="py-2"><%= @shopline_order.utm_content || "-" %></td>
        </tr>
        <tr>
          <td class="py-2 text-gray-600">UTM 點擊時間</td>
          <td class="py-2"><%= @shopline_order.utm_clicked_at&.strftime('%Y-%m-%d %H:%M') || "-" %></td>
        </tr>
      </table>
    </div>
  <% end %>
</div>