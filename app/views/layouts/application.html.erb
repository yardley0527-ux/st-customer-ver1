<!DOCTYPE html>
<%= render 'shared/copyright_header' %>
<html lang="en">
<head>
  <%= render 'shared/head' %>

  <%# Optional: page related CSS %>
  <%= yield :head_block %>
  <link rel="stylesheet" href="https://unpkg.com/@yaireo/tagify/dist/tagify.css">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

</head>
<body class="mod-bg-1 <%= yield(:preemptiveclass) %>">

<%# save-settings-script %>
<%= render 'shared/scripts_loading_saving' %>

<!-- BEGIN Page Wrapper -->
<div class="page-wrapper">

  <div class="page-inner">

    <%= render 'shared/left_panel' %>

    <div class="page-content-wrapper">

      <%= render 'shared/page_header' %>

      <!-- BEGIN Page Content -->
      <!-- the #js-page-content id is needed for some plugins to initialize -->
      <main id="js-page-content" role="main" class="page-content">
        <% if content_for?(:preemptiveclass) %>
          <!-- Page heading removed for composed layout -->
        <% else %>
          <%= render 'shared/page_breadcrumb' %>
          <%= render 'shared/page_heading' %>
        <% end %>
        <%= yield %>
      </main>
      <%= render 'shared/page_content_overlay' %>

      <!-- END Page Content -->

      <%= render 'shared/page_footer' %>

      <%= render 'shared/shortcut_modal' %>

      <%= render 'shared/color_profile_reference' %>

    </div>

  </div>

</div>
<!-- END Page Wrapper -->

<%= render 'shared/shortcut_menu' %>

<%= render 'shared/shortcut_messenger' %>

<%= render 'shared/page_settings' %>

<%= render 'shared/scripts_base_plugins' %>
<%# Custom scripts per page can be added. %>
<%= yield :scripts_block %>
<script src="https://unpkg.com/@yaireo/tagify"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<%= render 'shared/scripts_base_plugins' %>   <!-- SmartAdmin / app.bundle.js -->
<%= yield :scripts_block %>

<script>
(function shortcutToggles(){
  function bindButtons(){
    var btns = document.querySelectorAll('.dropdown-icon-menu [data-action="toggle"]');
    btns.forEach(function(btn){
      if (btn.__saBound) return;
      btn.__saBound = function(e){
        e.preventDefault();
        var html = document.documentElement;
        if (window.innerWidth < 992) {
          html.classList.toggle('mobile-nav-on');       // 手機：開/關
        } else {
          var k = btn.dataset.class;
          var t = btn.dataset.target || 'html';
          var el = document.querySelector(t);
          if (el && k) el.classList.toggle(k);          // 桌機：原行為
        }
      };
      btn.addEventListener('click', btn.__saBound, true); // 用 capture 防止被攔
    });
    console.log('[shortcut] bound', btns.length);
  }

  function bindOverlayClose(){
    var ov = document.querySelector('.page-content-overlay');
    if (!ov || ov.__saBound) return;
    ov.__saBound = true;
    ov.addEventListener('click', function(){
      document.documentElement.classList.remove('mobile-nav-on'); // 點遮罩關閉
    }, true);
  }

  function bindEsc(){
    if (document.__saEsc) return;
    document.__saEsc = true;
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape') document.documentElement.classList.remove('mobile-nav-on');
    });
  }

  function bindResizeGuard(){
    if (window.__saResize) return;
    var tid;
    window.__saResize = true;
    window.addEventListener('resize', function(){
      clearTimeout(tid);
      tid = setTimeout(function(){
        if (window.innerWidth >= 992) document.documentElement.classList.remove('mobile-nav-on');
      }, 120);
    });
  }

  function init(){
    bindButtons();
    bindOverlayClose();
    bindEsc();
    bindResizeGuard();
  }

  document.addEventListener('DOMContentLoaded', init);
  document.addEventListener('turbolinks:load', init);
  document.addEventListener('turbo:load', init);
})();
</script>



</body>
</html>


